Hello

How to resolve MemoryError: memory allocation failed with Micropython?
Asked 1 year, 6 months ago
Active 1 month ago
Viewed 2k times

1


Im working with a SiPy board from pycom for a proyect, and all goes well untill i implemented 2 new files (that doesn't modify proyect behavior itself), but after uploading new files and trying to run my code, it shows a MemoryError: Memory allocation failed, allocating 136 bytes.

i tried a os.fsformat("/flash") to clean the board and upload again the proyect but i ended up with the same error. I also tried to workaround the "error line" (just an import of another class that worked well) doesn't solve it, just found the same error later, in another import with different bytes allocated.

python
memory-management
micropython
Share
Follow
edited Nov 2 '21 at 17:02

Omer Dagan
12.2k1212 gold badges3939 silver badges5656 bronze badges
asked Jun 24 '20 at 8:09

Charlython
1122 bronze badges
1
How can this behaviour be replicated? – 
Klaus D.
 Jun 24 '20 at 8:17
I checked device info and, despite i have enough flash memory space, it seems the RAM or "Memory status" in device info is filled, 4MB/4MB, so i guess any board with filled RAM will tell the same error, i'd like to know how to clean RAM memory because it seems a problem in runtime. – 
Charlython
 Jun 24 '20 at 16:43
Add a comment
2 Answers

1

Depending on the micropython port you are working with you could consider using:

import micropython

micropython.alloc_emergency_exception_buf(100)
early in the boot.py file?

Share
Follow
edited Jul 28 '20 at 10:44

helvete
1,88477 gold badges3030 silver badges3131 bronze badges
answered Jul 28 '20 at 9:16
user12757608
Add a comment

Report this ad

1

If you have enough RAM on the target device, you might want to enlarge the heap size that is being used by micropython.

To check the memory data of micropython:

$ micropython
>>> import micropython
>>> micropython.mem_info()
mem: total=3818, current=728, peak=1592
stack: 464 out of 40000
GC: total: 1024512, used: 816, free: 1023696
 No. of 1-blocks: 13, 2-blocks: 7, max blk sz: 8, max free sz: 63971
The important part in my example is free: 1023696. So I could, for example, run micropython with 2MB heap memory available. To do this, use the following options:

$ micropython -X heapsize=2M
>>> import micropython
>>> micropython.mem_info()
mem: total=2620, current=542, peak=1406
stack: 464 out of 40000
GC: total: 2049088, used: 592, free: 2048496
 No. of 1-blocks: 8, 2-blocks: 6, max blk sz: 8, max free sz: 128019
 
 How to resolve MemoryError: memory allocation failed with Micropython?
Asked 1 year, 6 months ago
Active 1 month ago
Viewed 2k times

1


Im working with a SiPy board from pycom for a proyect, and all goes well untill i implemented 2 new files (that doesn't modify proyect behavior itself), but after uploading new files and trying to run my code, it shows a MemoryError: Memory allocation failed, allocating 136 bytes.

i tried a os.fsformat("/flash") to clean the board and upload again the proyect but i ended up with the same error. I also tried to workaround the "error line" (just an import of another class that worked well) doesn't solve it, just found the same error later, in another import with different bytes allocated.

python
memory-management
micropython
Share
Follow
edited Nov 2 '21 at 17:02

Omer Dagan
12.2k1212 gold badges3939 silver badges5656 bronze badges
asked Jun 24 '20 at 8:09

Charlython
1122 bronze badges
1
How can this behaviour be replicated? – 
Klaus D.
 Jun 24 '20 at 8:17
I checked device info and, despite i have enough flash memory space, it seems the RAM or "Memory status" in device info is filled, 4MB/4MB, so i guess any board with filled RAM will tell the same error, i'd like to know how to clean RAM memory because it seems a problem in runtime. – 
Charlython
 Jun 24 '20 at 16:43
Add a comment
2 Answers

1

Depending on the micropython port you are working with you could consider using:

import micropython

micropython.alloc_emergency_exception_buf(100)
early in the boot.py file?

Share
Follow
edited Jul 28 '20 at 10:44

helvete
1,88477 gold badges3030 silver badges3131 bronze badges
answered Jul 28 '20 at 9:16
user12757608
Add a comment

Report this ad

1

If you have enough RAM on the target device, you might want to enlarge the heap size that is being used by micropython.

To check the memory data of micropython:

$ micropython
>>> import micropython
>>> micropython.mem_info()
mem: total=3818, current=728, peak=1592
stack: 464 out of 40000
GC: total: 1024512, used: 816, free: 1023696
 No. of 1-blocks: 13, 2-blocks: 7, max blk sz: 8, max free sz: 63971
The important part in my example is free: 1023696. So I could, for example, run micropython with 2MB heap memory available. To do this, use the following options:

$ micropython -X heapsize=2M
>>> import micropython
>>> micropython.mem_info()
mem: total=2620, current=542, peak=1406
stack: 464 out of 40000
GC: total: 2049088, used: 592, free: 2048496
 No. of 1-blocks: 8, 2-blocks: 6, max blk sz: 8, max free sz: 128019
 
 How to resolve MemoryError: memory allocation failed with Micropython?
Asked 1 year, 6 months ago
Active 1 month ago
Viewed 2k times

1


Im working with a SiPy board from pycom for a proyect, and all goes well untill i implemented 2 new